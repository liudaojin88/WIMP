<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>跨境发货批次管理</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        
        
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .search-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .results-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.08);
        }
        
        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            padding: 10px 25px;
            font-weight: 500;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
            border: none;
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-outline-secondary {
            border-radius: 6px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .table {
            border-radius: 8px;
            overflow: hidden;
        }
        
        .table thead th {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: none;
            font-weight: 600;
            color: #495057;
            padding: 15px;
        }
        
        .table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-color: #f1f3f4;
        }
        
        .table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom: none;
        }
        
        .modal-header .btn-close {
            filter: invert(1);
        }
        
        .upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background-color: #f0f2ff;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background-color: #e8ecff;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .search-btn-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        @media (max-width: 768px) {
            .search-btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .search-btn-group .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    
    
    <!-- 主内容区域 -->
    <div class="container-fluid">
        <!-- 页面标题 -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>跨境发货批次管理</h2>
            <div class="d-flex align-items-center">
                <span class="text-muted me-3">欢迎您，管理员</span>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-1"></i>账户
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>个人资料</a></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>设置</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>退出登录</a></li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 内容区域 -->
        <div>
            <!-- 页面标题 -->
    <div class="page-header">
        <div class="container">
            <h1 class="mb-0">
                <i class="bi bi-box-seam me-3"></i>跨境发货批次管理
            </h1>
        </div>
    </div>

    <div class="container">
        <!-- 查询区域 -->
        <div class="search-section">
            <div class="section-title">
                <i class="bi bi-search me-2"></i>查询条件
            </div>
            
            <form id="searchForm">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="batchNumbers" class="form-label">批次号</label>
                        <textarea 
                            class="form-control" 
                            id="batchNumbers" 
                            rows="3" 
                            placeholder="输入批次号，支持多个批次号查询，每行一个或用逗号分隔"
                        ></textarea>
                        <div class="form-text">支持多个批次号查询，可换行或用逗号分隔</div>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="startDate" class="form-label">创建时间（开始）</label>
                        <input type="date" class="form-control" id="startDate">
                    </div>
                    
                    <div class="col-md-3">
                        <label for="endDate" class="form-label">创建时间（结束）</label>
                        <input type="date" class="form-control" id="endDate">
                    </div>
                    
                    <div class="col-md-6">
                        <label for="creator" class="form-label">创建人</label>
                        <input type="text" class="form-control" id="creator" placeholder="输入创建人姓名">
                    </div>
                    
                    <div class="col-md-6 d-flex align-items-end">
                        <div class="search-btn-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-search me-2"></i>查询
                            </button>
                            <button type="reset" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-clockwise me-2"></i>重置
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- 查询结果区域 -->
        <div class="results-section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="section-title mb-0">
                    <i class="bi bi-table me-2"></i>查询结果
                </div>
                
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#importModal">
                        <i class="bi bi-upload me-2"></i>批量导入
                    </button>
                    <button type="button" class="btn btn-outline-primary" onclick="exportData()">
                        <i class="bi bi-download me-2"></i>导出数据
                    </button>
                </div>
            </div>
            
            <!-- 结果统计 -->
            <div class="row mb-3">
                <div class="col-12">
                    <div class="alert alert-info mb-3">
                        <i class="bi bi-info-circle me-2"></i>
                        共查询到 <strong id="totalCount">0</strong> 条记录
                    </div>
                </div>
            </div>
            
            <!-- 数据表格 -->
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th width="5%">
                                <input type="checkbox" class="form-check-input" id="selectAll">
                            </th>
                            <th width="20%">发货批次号</th>
                            <th width="15%">ATA</th>
                            <th width="15%">ATD</th>
                            <th width="15%">创建人</th>
                            <th width="20%">创建时间</th>
                            <th width="10%">操作</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody">
                        <!-- 示例数据 -->
                        <tr>
                            <td><input type="checkbox" class="form-check-input row-checkbox"></td>
                            <td><strong>SH2024001001</strong></td>
                            <td>2024-01-15 14:30</td>
                            <td>2024-01-16 08:45</td>
                            <td>张三</td>
                            <td>2024-01-10 09:15:30</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewDetails('SH2024001001')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="form-check-input row-checkbox"></td>
                            <td><strong>SH2024001002</strong></td>
                            <td>2024-01-16 10:20</td>
                            <td>2024-01-17 15:30</td>
                            <td>李四</td>
                            <td>2024-01-11 11:25:45</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewDetails('SH2024001002')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="form-check-input row-checkbox"></td>
                            <td><strong>SH2024001003</strong></td>
                            <td>2024-01-17 16:45</td>
                            <td>-</td>
                            <td>王五</td>
                            <td>2024-01-12 14:10:20</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewDetails('SH2024001003')">
                                    <i class="bi bi-eye"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- 分页 -->
            <nav aria-label="分页导航">
                <ul class="pagination justify-content-center mt-4">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1">上一页</a>
                    </li>
                    <li class="page-item active">
                        <a class="page-link" href="#">1</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">2</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">3</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="#">下一页</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- 批量导入弹框 -->
    <div class="modal fade" id="importModal" tabindex="-1" aria-labelledby="importModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="importModalLabel">
                        <i class="bi bi-upload me-2"></i>批量导入发货批次
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12 mb-4">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-download me-2"></i>步骤1：下载Excel模板
                            </h6>
                            <p class="text-muted mb-3">请先下载标准Excel模板，按照模板格式填写数据</p>
                            <button type="button" class="btn btn-outline-primary" onclick="downloadTemplate()">
                                <i class="bi bi-file-earmark-excel me-2"></i>下载Excel模板
                            </button>
                        </div>
                        
                        <div class="col-12">
                            <h6 class="fw-bold mb-3">
                                <i class="bi bi-upload me-2"></i>步骤2：上传Excel文件
                            </h6>
                            
                            <div class="upload-area" id="uploadArea">
                                <i class="bi bi-cloud-upload display-4 text-muted mb-3"></i>
                                <p class="mb-2">将Excel文件拖拽到此处，或点击选择文件</p>
                                <p class="text-muted small mb-3">支持.xlsx, .xls格式，文件大小不超过10MB</p>
                                <input type="file" class="d-none" id="fileInput" accept=".xlsx,.xls">
                                <button type="button" class="btn btn-outline-secondary" onclick="document.getElementById('fileInput').click()">
                                    <i class="bi bi-folder2-open me-2"></i>选择文件
                                </button>
                            </div>
                            
                            <div id="fileInfo" class="mt-3" style="display: none;">
                                <div class="alert alert-success">
                                    <i class="bi bi-check-circle me-2"></i>
                                    已选择文件：<span id="fileName"></span>
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="clearFile()">
                                        <i class="bi bi-x"></i>移除
                                    </button>
                                </div>
                            </div>
                            
                            <div id="uploadProgress" class="mt-3" style="display: none;">
                                <div class="progress">
                                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="uploadBtn" onclick="uploadFile()" disabled>
                        <i class="bi bi-upload me-2"></i>开始导入
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializePage();
            updateTotalCount();
        });

        // 初始化页面功能
        function initializePage() {
            // 设置默认日期范围（最近30天）
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
            
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
            document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            
            // 绑定全选复选框事件
            document.getElementById('selectAll').addEventListener('change', function() {
                const checkboxes = document.querySelectorAll('.row-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
            });
            
            // 绑定行复选框事件
            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('row-checkbox')) {
                    updateSelectAllState();
                }
            });
            
            // 初始化文件上传功能
            initializeFileUpload();
        }

        // 更新总记录数
        function updateTotalCount() {
            const rows = document.querySelectorAll('#dataTableBody tr');
            document.getElementById('totalCount').textContent = rows.length;
        }

        // 更新全选状态
        function updateSelectAllState() {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            const selectAllCheckbox = document.getElementById('selectAll');
            
            if (checkedBoxes.length === 0) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = false;
            } else if (checkedBoxes.length === checkboxes.length) {
                selectAllCheckbox.indeterminate = false;
                selectAllCheckbox.checked = true;
            } else {
                selectAllCheckbox.indeterminate = true;
            }
        }

        // 搜索表单提交
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            performSearch();
        });

        // 执行搜索
        function performSearch() {
            const batchNumbers = document.getElementById('batchNumbers').value.trim();
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const creator = document.getElementById('creator').value.trim();
            
            // 这里应该调用后端API进行搜索
            console.log('搜索参数:', {
                batchNumbers: batchNumbers.split(/[,\n]/).map(s => s.trim()).filter(s => s),
                startDate,
                endDate,
                creator
            });
            
            // 模拟搜索结果
            showSearchResults();
        }

        // 显示搜索结果
        function showSearchResults() {
            // 这里应该根据实际搜索结果更新表格
            updateTotalCount();
            
            // 显示成功消息
            showMessage('搜索完成', 'success');
        }

        // 重置表单
        document.getElementById('searchForm').addEventListener('reset', function() {
            setTimeout(() => {
                const today = new Date();
                const thirtyDaysAgo = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000);
                
                document.getElementById('endDate').value = today.toISOString().split('T')[0];
                document.getElementById('startDate').value = thirtyDaysAgo.toISOString().split('T')[0];
            }, 0);
        });

        // 查看详情
        function viewDetails(batchNumber) {
            alert(`查看批次 ${batchNumber} 的详细信息`);
            // 这里应该打开详情页面或弹框
        }

        // 导出数据
        function exportData() {
            const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
            if (checkedBoxes.length === 0) {
                showMessage('请先选择要导出的数据', 'warning');
                return;
            }
            
            // 模拟导出功能
            showMessage(`正在导出 ${checkedBoxes.length} 条记录...`, 'info');
            
            // 这里应该调用后端API进行数据导出
            setTimeout(() => {
                showMessage('导出完成', 'success');
            }, 2000);
        }

        // 下载Excel模板
        function downloadTemplate() {
            // 创建模拟的Excel模板数据
            const templateData = [
                ['发货批次号', 'ATA', 'ATD', '创建人', '备注'],
                ['SH2024001001', '2024-01-15 14:30', '2024-01-16 08:45', '张三', '示例数据'],
                ['SH2024001002', '2024-01-16 10:20', '2024-01-17 15:30', '李四', '示例数据']
            ];
            
            // 这里应该生成真实的Excel文件
            showMessage('Excel模板下载已开始', 'success');
            
            // 模拟下载
            const blob = new Blob([templateData.map(row => row.join('\t')).join('\n')], {
                type: 'application/vnd.ms-excel'
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '发货批次导入模板.xls';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 初始化文件上传功能
        function initializeFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const uploadBtn = document.getElementById('uploadBtn');

            // 拖拽上传
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files[0]);
                }
            });

            // 文件选择
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    handleFileSelect(e.target.files[0]);
                }
            });

            // 处理文件选择
            function handleFileSelect(file) {
                if (!file.name.match(/\.(xlsx|xls)$/)) {
                    showMessage('请选择Excel文件（.xlsx 或 .xls 格式）', 'error');
                    return;
                }
                
                if (file.size > 10 * 1024 * 1024) {
                    showMessage('文件大小不能超过10MB', 'error');
                    return;
                }
                
                fileName.textContent = file.name;
                fileInfo.style.display = 'block';
                uploadBtn.disabled = false;
                
                // 存储文件引用
                uploadArea.selectedFile = file;
            }
        }

        // 清除文件
        function clearFile() {
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('uploadBtn').disabled = true;
            document.getElementById('uploadArea').selectedFile = null;
        }

        // 上传文件
        function uploadFile() {
            const uploadArea = document.getElementById('uploadArea');
            const file = uploadArea.selectedFile;
            
            if (!file) {
                showMessage('请先选择文件', 'error');
                return;
            }
            
            const uploadProgress = document.getElementById('uploadProgress');
            const progressBar = uploadProgress.querySelector('.progress-bar');
            
            uploadProgress.style.display = 'block';
            document.getElementById('uploadBtn').disabled = true;
            
            // 模拟上传进度
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 30;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        uploadProgress.style.display = 'none';
                        showMessage('文件上传成功，正在处理数据...', 'success');
                        
                        // 关闭弹框
                        const modal = bootstrap.Modal.getInstance(document.getElementById('importModal'));
                        modal.hide();
                        
                        // 清除文件
                        clearFile();
                        
                        // 刷新数据
                        setTimeout(() => {
                            showMessage('数据导入完成', 'success');
                            performSearch();
                        }, 2000);
                    }, 500);
                }
            }, 200);
        }

        // 显示消息提示
        function showMessage(message, type = 'info') {
            // 创建Toast消息
            const toastContainer = document.getElementById('toastContainer') || createToastContainer();
            
            const toastId = 'toast_' + Date.now();
            const toastHtml = `
                <div class="toast align-items-center text-bg-${type === 'error' ? 'danger' : type} border-0" role="alert" id="${toastId}">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="bi bi-${getIconForType(type)} me-2"></i>${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHtml);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement);
            toast.show();
            
            // 自动移除已显示的toast
            toastElement.addEventListener('hidden.bs.toast', function() {
                toastElement.remove();
            });
        }

        // 创建Toast容器
        function createToastContainer() {
            const container = document.createElement('div');
            container.id = 'toastContainer';
            container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
            container.style.zIndex = '1055';
            document.body.appendChild(container);
            return container;
        }

        // 获取消息类型对应的图标
        function getIconForType(type) {
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }
    </script>

</body>
</html>